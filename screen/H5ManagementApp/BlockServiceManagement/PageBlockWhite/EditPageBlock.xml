<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-include="false" standalone="true">

    <parameter name="blockId" required="true"/>

    <transition name="editPageBlock">
        <service-call name="moqui.h5Management.H5ManagementServices.edit#PageBlock" in-map="context" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="addBlockUrlBizService">
        <default-response url="../AddBlockBizService" parameter-map="[serviceDataTypeEnumId:'URL']"></default-response>
    </transition>

    <transition name="addBlockAppBizService">
        <default-response url="../AddBlockBizService" parameter-map="[serviceDataTypeEnumId:'APP']"></default-response>
    </transition>
    
    <transition name="editBlockBizService">
        <default-response url="../AddBlockBizService" parameter-map="context"></default-response>
    </transition>
    
    <transition name="deleteBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.delete#BlockBizService" in-map="context" out-map="context"/>
        <default-response url="."></default-response>
    </transition>
    
    <transition name="enableBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.enable#BlockBizService" in-map="context+[enabled:'Y']" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="disableBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.enable#BlockBizService" in-map="context+[enabled:'N']" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="freezeBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.freeze#BlockBizService" in-map="context+[freeze:'Y']" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="unfreezeBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.freeze#BlockBizService" in-map="context+[freeze:'N']" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="ascendBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.ascend#BlockBizService" in-map="context" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="descendBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.descend#BlockBizService" in-map="context" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="setTopBlockBizService">
        <service-call name="moqui.h5Management.H5ManagementServices.setTop#BlockBizService" in-map="context" out-map="context"/>
        <default-response url="."></default-response>
    </transition>

    <transition name="getBlockServiceDetail">
        <default-response url="../ViewBlockBizService" parameter-map="context"/>
    </transition>

    <actions>
        <entity-find-one entity-name="mantle.mfexcel.h5page.PageBlock" value-field="pageBlock"/>
        <if condition="pageBlock">
            <entity-find-one entity-name="moqui.security.UserAccount" value-field="createUserAccount">
                <field-map field-name="userId" from="pageBlock.createdByUserId"/>
            </entity-find-one>
            <entity-find-one entity-name="moqui.security.UserAccount" value-field="updateUserAccount">
                <field-map field-name="userId" from="pageBlock.lastUpdatedByUserId"/>
            </entity-find-one>
        </if>
    </actions>

    <widgets>
        <container-row>
            <row-col lg="6">
                <container-box allow-fold="false">
                    <box-header>
                        <label text="区块信息"/>
                    </box-header>
                    <box-body>
                        <form-single name="EditPageBlockForm" transition="editPageBlock" map="pageBlock">
                            <field name="blockId">
                                <default-field>
                                    <hidden/>
                                </default-field>
                            </field>
                            <field name="name" label-cols="8">
                                <default-field title="区块名称">
                                    <text-line maxlength="40"/>
                                </default-field>
                            </field>
                            <field name="blockKey" label-cols="8">
                                <default-field title="区块唯一标识">
                                    <text-line readonly="true"/>
                                </default-field>
                            </field>
                            <field name="submitButton">
                                <default-field title="保存">
                                    <submit/>
                                </default-field>
                            </field>
                        </form-single>
                    </box-body>
                </container-box>
            </row-col>
            <row-col lg="18">
                <container-box allow-fold="false">
                    <box-header>
                        <label text="服务信息"/>
                    </box-header>
                    <box-body>
                        <container-row>
                            <row-col>
                                <dynamic-dialog id="addBlockUrlBizServiceDialog" button-text="添加URL服务" transition="addBlockUrlBizService"/>
                                <dynamic-dialog id="addBlockAppBizServiceDialog" button-text="添加APP服务" transition="addBlockAppBizService"/>
                            </row-col>
                        </container-row>
                        <form-list name="BizServiceList" list="bizServiceList" use-widget="aggrid" auto-stretch="true">
                            <entity-find entity-name="mantle.mfexcel.h5page.PageBlockServiceApplDetailView"
                                         list="bizServiceList">
                                <search-form-inputs/>
                                <econdition field-name="blockId" from="blockId"/>
                                <econdition field-name="thruDate" operator="is-null"/>
                                <order-by field-name="+orderNumber"/>
                            </entity-find>
                            <row-actions>
                                <if condition="enabled == 'Y'">
                                    <set field="enabledText" value="上架"/>
                                    <set field="enabledCond" from="false"/>
                                    <set field="disabledCond" from="true"/>
                                    <else>
                                        <set field="enabledText" value="下架"/>
                                        <set field="enabledCond" from="true"/>
                                        <set field="disabledCond" from="false"/>
                                    </else>
                                </if>
                                <if condition="freeze == 'Y'">
                                    <set field="freezeText" value="冻结"/>
                                    <set field="freezeCond" from="false"/>
                                    <set field="unfreezeCond" from="true"/>
                                    <else>
                                        <set field="freezeText" value="未冻结"/>
                                        <set field="freezeCond" from="true"/>
                                        <set field="unfreezeCond" from="false"/>
                                    </else>
                                </if>
                            </row-actions>
                            <field name="blockId">
                                <default-field>
                                    <hidden/>
                                </default-field>
                            </field>
                            <field name="serviceId">
                                <default-field>
                                    <hidden/>
                                </default-field>
                            </field>
                            <field name="pseudoId">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="服务编码">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="name">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="服务名称">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="serviceDataTypeEnumId">
                                <default-field>
                                    <hidden/>
                                </default-field>
                            </field>
                            <field name="serviceDataTypeName">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="服务类型">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="url">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="服务地址">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="appPackage">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="App包名">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="enabled">
                                <header-field>
                                    <drop-down allow-empty="true">
                                        <option key="" text="全部"/>
                                        <option key="Y" text="上架"/>
                                        <option key="N" text="下架"/>
                                    </drop-down>
                                </header-field>
                                <default-field title="上架/下架">
                                    <display text="${enabledText}"/>
                                </default-field>
                            </field>
                            <field name="freeze">
                                <header-field>
                                    <drop-down allow-empty="true">
                                        <option key="" text="全部"/>
                                        <option key="Y" text="冻结"/>
                                        <option key="N" text="未冻结"/>
                                    </drop-down>
                                </header-field>
                                <default-field title="冻结/未冻结">
                                    <display text="${freezeText}"/>
                                </default-field>
                            </field>
                            <field name="detail">
                                <default-field title="详情">
                                    <link url="getBlockServiceDetail" text="查看" link-parameters="{'blockId':'blockId','serviceId':'serviceId','serviceDataTypeEnumId':'serviceDataTypeEnumId'}" target-dialog="viewDynamicDialog"/>
                                </default-field>
                            </field>
                            <field name="orderNumber">
                                <header-field>
                                    <text-find/>
                                </header-field>
                                <default-field title="排序">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="operationButton" is-action-column="true" width="350">
                                <header-field>
                                    <reset/>
                                </header-field>
                                <default-field title="操作">
                                    <link url="editBlockBizService" btn-type="primary" text="编辑" target-dialog="editDynamicDialog"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId','serviceDataTypeEnumId':'serviceDataTypeEnumId'}"/>
                                    <link url="enableBlockBizService" btn-type="primary" text="上架"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}" display-condition-field="enabledCond"/>
                                    <link url="disableBlockBizService" btn-type="danger" text="下架"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}" display-condition-field="disabledCond"/>
                                    <link url="freezeBlockBizService" btn-type="danger" text="冻结"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}" display-condition-field="freezeCond"/>
                                    <link url="unfreezeBlockBizService" btn-type="primary" text="解冻"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}" display-condition-field="unfreezeCond"/>
                                    <link url="ascendBlockBizService" btn-type="success" text="升序"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}"/>
                                    <link url="descendBlockBizService" btn-type="success" text="降序"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}"/>
                                    <link url="setTopBlockBizService" btn-type="success" text="置顶"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}"/>
                                    <link url="deleteBlockBizService" btn-type="danger" text="删除"
                                          link-parameters="{'blockId':'blockId','serviceId':'serviceId'}"
                                          confirmation="您确认删除该数据吗？"/>
                                </default-field>
                            </field>
                        </form-list>
                    </box-body>
                </container-box>
            </row-col>
        </container-row>
        <grid-dynamic-dialog id="editDynamicDialog" title="编辑"/>
        <grid-dynamic-dialog id="viewDynamicDialog" title="详情"/>
    </widgets>
</screen>